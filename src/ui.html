<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 16px;
      color: #333;
    }

    .container {
      max-width: 100%;
    }

    .header {
      margin-bottom: 20px;
    }

    .title {
      font-size: 18px;
      font-weight: bold;
      color: #1a73e8;
      margin-bottom: 8px;
    }

    .prompt-area {
      width: 100%;
      min-height: 100px;
      padding: 8px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
      font-family: inherit;
      box-sizing: border-box;
    }

    .button {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .button:hover {
      background-color: #1557b0;
    }

    .button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .loading {
      display: none;
      margin-top: 12px;
      color: #666;
    }

    .loading.active {
      display: block;
    }

    .result {
      margin-top: 20px;
      padding: 12px;
      background-color: #f8f9fa;
      border-radius: 4px;
      white-space: pre-wrap;
    }

    .error {
      color: #d93025;
      margin-top: 8px;
      display: none;
    }

    .preset-prompts {
      margin-top: 16px;
      border-top: 1px solid #eee;
      padding-top: 16px;
    }

    .preset-button {
      background-color: #f1f3f4;
      color: #333;
      border: 1px solid #dadce0;
      padding: 6px 12px;
      margin: 4px;
      border-radius: 16px;
      cursor: pointer;
      font-size: 13px;
    }

    .preset-button:hover {
      background-color: #e8eaed;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">GPT –ü–æ–º–æ—â–Ω–∏–∫</div>
      <div>–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
    </div>

    <textarea 
      id="prompt" 
      class="prompt-area" 
      placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å –∑–¥–µ—Å—å..."></textarea>

    <button 
      id="generateBtn" 
      class="button" 
      onclick="generateText()">
      –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
    </button>

    <div id="loading" class="loading">
      –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞... ‚ö°
    </div>

    <div id="error" class="error"></div>

    <div id="result" class="result" style="display: none;"></div>

    <div class="preset-prompts">
      <div style="margin-bottom: 8px;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</div>
      <button class="preset-button" onclick="usePreset('improve')">
        ‚ú® –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç
      </button>
      <button class="preset-button" onclick="usePreset('summarize')">
        üìù –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
      </button>
      <button class="preset-button" onclick="usePreset('grammar')">
        üîç –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≥—Ä–∞–º–º–∞—Ç–∏–∫—É
      </button>
    </div>
  </div>

  <script>
    // Get DOM elements
    const promptArea = document.getElementById('prompt');
    const generateBtn = document.getElementById('generateBtn');
    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const resultDiv = document.getElementById('result');

    // Handle text generation
    function generateText() {
      const prompt = promptArea.value.trim();
      
      if (!prompt) {
        showError('Please enter a prompt');
        return;
      }

      setLoading(true);
      hideError();
      
      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .callOpenAI(prompt);
    }

    // Handle preset prompts
    function usePreset(type) {
      const selectedText = promptArea.value.trim();
      let prompt = '';

      switch(type) {
        case 'improve':
          prompt = `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–ª—É—á—à–∏—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–º—ã—Å–ª: "${selectedText}"`;
          break;
        case 'summarize':
          prompt = `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–¥–µ–ª–∞–π—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: "${selectedText}"`;
          break;
        case 'grammar':
          prompt = `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ —ç—Ç–æ–º —Ç–µ–∫—Å—Ç–µ: "${selectedText}"`;
          break;
      }

      promptArea.value = prompt;
    }

    // Success handler
    function onSuccess(response) {
      setLoading(false);
      resultDiv.style.display = 'block';
      resultDiv.textContent = response;
    }

    // Error handler
    function onFailure(error) {
      setLoading(false);
      showError('Error: ' + error.message);
    }

    // Helper functions
    function setLoading(isLoading) {
      generateBtn.disabled = isLoading;
      loadingDiv.classList.toggle('active', isLoading);
    }

    function showError(message) {
      errorDiv.style.display = 'block';
      errorDiv.textContent = '–û—à–∏–±–∫–∞: ' + message;
    }

    function hideError() {
      errorDiv.style.display = 'none';
    }
  </script>
</body>
</html>
